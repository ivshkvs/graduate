EC2Instance:
  !If 
    - UsePreviousTemplate 
    - Type: "AWS::CloudFormation::Stack"
      Properties:
        TemplateURL: !Sub "https://s3.amazonaws.com/${calendartelebucket}/${template.yaml}"
    - Type: "AWS::EC2::Instance"
      Properties:
        ImageId: "ami-01fd08d7b0955d6d5"
        InstanceType: "t2.micro"
        SecurityGroupIds:
          - !If 
            - UsePreviousTemplate 
            - !Ref InstanceSecurityGroup 
            - !If 
              - EC2SecurityGroup 
              - !Ref EC2SecurityGroup 
              - !Ref "AWS::NoValue"
        KeyName: "aws"
        Tags:
          - Key: Name
            Value: !Sub "${AWS::StackName}"
        UserData:
          Fn::Base64: !Sub |
            #!/bin/bash
            yum update -y
            amazon-linux-extras install docker -y
            systemctl start docker
            usermod -aG docker ec2-user
            docker login -u ivshkvs -p dckr_pat_w1f9n80eI3PRBXwH_oQZszObTPQ
            docker run -d ivshkvs/tg_bot:latest
            docker run -d -p 9090:9090 prom/prometheus
